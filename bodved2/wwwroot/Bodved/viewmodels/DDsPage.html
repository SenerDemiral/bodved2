<link href="/sys/paper-dialog/paper-dialog.html" rel="import" />
<link rel="import" href="/sys/juicy-select/juicy-select.html">

<template>
    <dom-bind id="DDsPage">
        <template is="dom-bind">
            <paper-dialog opened="[[model.DD.Opened]]" modal="true">
                <div class="mdfRecWrap">
                    <label>Rec#</label>
                    <input placeholder="oNo" type="text" value="{{model.DD.ONo$::change}}" readonly style="text-align:center" />
                    <label>Ad</label>
                    <input placeholder="Ad" type="text" value="{{model.DD.Ad$::change}}" />
                    <label>Sezon</label>
                    <input placeholder="Sezon" type="text" value="{{model.DD.Dnm$::change}}" />
                    <label>Info</label>
                    <input placeholder="Info" type="text" value="{{model.DD.Info$::change}}" />
                    <label>PPoNo</label>
                    <input placeholder="Sezon" type="text" value="{{model.DD.PPoNo$::change}}" />
                    <label>PPoNo2</label>
                    <juicy-select caption-text="PPs" value="{{model.DD.PPoNo$}}" options=[[getpps()]] text-property="Ad" value-property="PPoNo"></juicy-select>
                </div>
                <div class="mdfRecAction">
                    <template is="dom-if" if="[[model.DD.IsNew]]">
                        <button value="{{model.DD.InsTrgr$::click}}" onmousedown="++this.value">Insert</button>
                        <button value="{{model.DD.UpdTrgr$::click}}" onmousedown="++this.value" style="visibility:hidden">Update</button>
                        <button value="{{model.DD.DelTrgr$::click}}" onmousedown="++this.value" style="visibility:hidden">Delete</button>
                    </template>
                    <template is="dom-if" if="[[!model.DD.IsNew]]">
                        <button value="{{model.DD.InsTrgr$::click}}" onmousedown="++this.value">Duplicate</button>
                        <button value="{{model.DD.UpdTrgr$::click}}" onmousedown="++this.value">Update</button>
                        <button value="{{model.DD.DelTrgr$::click}}" onmousedown="++this.value">Delete</button>
                    </template>
                </div>
                <div class="mdfRecAction">
                    <button dialog-dismiss value="{{model.DD.RejTrgr$::click}}" onmousedown="++this.value" style="width:100%">Vazgeç</button>
                </div>
            </paper-dialog>


            <div class="gridTbl">
                <div class="gridTbl_header">
                    <div>BODVED Aktiviteleri</div>
                    <button value="{{model.DD.NewTrgr$::click}}" onmousedown="++this.value" hidden$="[[!model.canMdfy]]">New</button>
                </div>
                <div class="gridTbl_main">
                    <table id="ddTbl" class="fixTbl">
                        <colgroup>
                            <col style="width:8rem" hidden$="[[!model.canMdfy]]" />
                            <col style="width:14rem" />
                            <col style="width:5rem" />
                            <col style="width:5rem" />
                            <col style="width:5rem" />
                            <col style="width:5rem" />
                            <col style="width:5rem" />
                            <col style="width:5rem" />
                            <col style="width:20rem" />
                            <!--
    <col style="width:5rem" />
    <col style="width:20rem" />-->
                        </colgroup>
                        <thead>
                            <tr>
                                <th rowspan="2" hidden$="[[!model.canMdfy]]">Edit</th>
                                <th rowspan="2">Aktivite</th>
                                <th rowspan="2"><iron-icon icon="vaadin:user"></iron-icon></th>
                                <th colspan="2">Oyuncu</th>
                                <th colspan="3">Oynanmış</th>
                                <th rowspan="2">Info</th>
                            </tr>
                            <tr>
                                <th>Kayıtlı</th>
                                <th>Oynamış</th>
                                <th>Maç</th>
                                <th>Set</th>
                                <th>Sayı</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template is="dom-repeat" items="{{model.DDs}}">
                                <tr>
                                    <td hidden$="[[!model.canMdfy]]"><button class="edit" value="{{item.EdtTrgr$::click}}" onmousedown="++this.value"><iron-icon icon="vaadin:edit"></iron-icon>[[item.DDoNo]]</button></td>
                                    <td class="txtLeft"><a href="/bodved/CCs/[[item.Dnm]]">[[item.Ad]]</a></td>
                                    <td><a href="/bodved/PPRDs/[[item.Dnm]]">►►</a></td>
                                    <td>[[item.KOC_]]</td>
                                    <td>[[item.OOC_]]</td>
                                    <td>[[item.Mac]]</td>
                                    <td>[[item.Set]]</td>
                                    <td>[[item.Sayi]]</td>
                                    <td class="colInfo" on-tap="doSomething" data-item$="[[index]]">[[item.Info]]</td>
                                    <!--
    <td>[[item.PPoNo]]</td>
    <td>[[item.PPAd]]</td>
                                    -->
                                </tr>
                            </template>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td></td>
                                <td>TOPLAM</td>
                                <td>[[model.TopPP]]</td>
                                <td>[[model.RunPP]]</td>
                                <td>[[model.TopMac]]</td>
                                <td>[[model.TopSet]]</td>
                                <td>[[model.TopSayi]]</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

        </template>
    </dom-bind>

    <script>
        console.log('ddTbl 1', document.querySelector('#ddTbl'));
        console.log('ddTbl', document.querySelector('template'));


        (function () {
            //const script = document._currentScript || document.currentScript;   // Local scope
            const tmplt = (document._currentScript || document.currentScript).previousElementSibling;

            tmplt.addEventListener('model-changed', function (e) {
                //console.log("yey! myobj-changed works! DD", e)
            });

            tmplt.addEventListener('dom-ready', function () {
                console.log('dom-ready--', this);
            });

            // Bu partial aktive oldugunda calisir
            // 2 sekilde de options set edilebilir
            tmplt.addEventListener('dom-change', (e) => {
                //console.log('dom-change--', this);
                //console.log('juicy-select', document.querySelector('juicy-select'));
                var juicyselect = document.querySelector('juicy-select');
                //juicyselect.options = tmpltM.model.PPs;   // 1
            });

            tmplt.getpps = function () {
                console.log('getpps-----------------', this);
                return tmpltM.model.PPs;    // 2
            }

            tmplt.abcd = tmplt.model.DDs;
            //tmplt.abcd[0].XX = "xxxxxxx";
            //ccc = JSON.parse(JSON.stringify(tmplt.model.DDs));
            //tmplt.abcd = ccc.sort((a, b) => a - b);

            tmplt.doSomething = function (e) {
                const idx = e.target.dataset.item;
                console.log('idx', idx);
                console.log('tmplt.model.DDs[idx]', tmplt.model.DDs[idx]);
                var find = tmplt.model.DDs.find(obj => { return obj.DDoNo === 6825 });
                console.log('find by oNo', find);
                console.log('e.model.item', e.model.item);

                tmplt.mdfRec = e.model.item;
                e.model.set('item.Ad$', e.model.item.Ad$ + ' 1');
            }

            tmplt._myOpenFunction = function (e) {
                console.log('event', e);
                console.log('_myOpenFunction', tmplt.model.NewNo);
                var findItem = tmplt.model.DDs.find(obj => { return obj.DDoNo === tmplt.model.NewNo });
                tmplt.mdfRec = findItem;
            }

            tmplt._myNewFunction = function (e) {
                console.log('event.target.value', e.target.value);

                //e.target.value++;
                tmplt.model.DlgInsertTrigger$++;
                console.log('tmplt', tmplt);
                setTimeout(() => {
                    //tmplt.model.DlgInsertTrigger$++;
                    console.log('tmplt.model.DlgInsertTrigger$', tmplt.model.DlgInsertTrigger$);
                    console.log('tmplt.model.NewNo', tmplt.model.NewNo);
                    console.log('tmplt', tmplt);
                }, 100);

            }
        })();
    </script>

</template>

